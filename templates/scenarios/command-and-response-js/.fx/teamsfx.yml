version: 1.0.0

provision:
  - uses: botAadApp/create # Creates a new AAD app for Azure Bot service if BOT_ID environment variable is empty
    with:
      name: command-bot
    # Output: following environment variable will be persisted in current environment's .env file.
    # BOT_ID: the AAD app client id created for Azure Bot
    # BOT_PASSWORD: the AAD app client secret created for Azure Bot

deploy:
- uses: build/npm # Run npm command
  with:
    workingDirectory: ./bot
    args: install
- uses: build/npm # Run npm command
  with:
    workingDirectory: ./bot
    args: run build
- uses: deploy/azureAppService # Deploy bits to Azure App Serivce
  with:
    workingDirectory: ./bot
    distributionPath: ./ # Deploy base folder
    ignoreFile: ./.appserviceIgnore # Can be changed to any ignore file location, leave blank will ignore nothing
    resourceId: ${{ BOT_AZURE_APP_SERVICE_RESOURCE_ID }} # The resource id of the cloud resource to be deployed to

registerApp:
  - uses: teamsApp/create # Creates a Teams app
    # Output: following environment variable will be persisted in current environment's .env file.
    # TEAMS_APP_ID: the id of Teams app

configureApp:
  - uses: teamsApp/update # Apply the Teams app manifest to an existing Teams app. Will use the app id in manifest file to determine which Teams app to update.
    with:
      manifestTemplate: ./.fx/appPackage/manifest.template.json # Relative path to this file. Environment variables in manifest will be replaced before apply to Teams app

publish:
  - uses: teamsApp/createAppPackage # Generate a Teams app manifest package which can be used to publish the app
    with:
      manifestTemplate: ./.fx/appPackage/manifest.template.json # Relative path to this file
      outputPath: ./build/manifest.${{TEAMSFX_ENV}}.zip # Relative path to this file. TEAMSFX_ENV is a built-in environment variable whose value is current environment's name.

  - uses: teamsApp/publishAppPackage # Publish the app to Teams app catalog
    with:
      zipPath: ./build/manifest.${{TEAMSFX_ENV}}.zip # Relative path to this file. TEAMSFX_ENV is a built-in environment variable whose value is current environment's name.